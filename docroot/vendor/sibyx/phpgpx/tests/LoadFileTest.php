<?php

namespace phpGPX\Tests;

use phpGPX\phpGPX;
use PHPUnit\Framework\TestCase;

class LoadFileTest extends TestCase
{
	public function testLoadXmlFileGeneratedByTimezero()
	{
		$file = __DIR__.'/fixtures/timezero.gpx';

		$gpx = new phpGpx();
		$gpxFile = $gpx->load($file);

		$this->assertEquals($this->createExpectedArray(), $gpxFile->toArray(), "", 0.0001);

		// Check XML generation
		$gpxFile->toXML()->saveXML();
	}

	private function createExpectedArray()
	{
		return [
			'creator' => null,
			'metadata' => null,
			'waypoints' => [
				[
					'lat' => 49.3636333333086,
					'lon' => 0.0800866666666667,
					'ele' => null,
					'time' => '2014-12-13T16:32:51+00:00',
					'magvar' => null,
					'geoidheight' => null,
					'name' => 'Event 0000',
					'cmt' => null,
					'desc' => null,
					'src' => null,
					'link' => [],
					'sym' => null,
					'type' => null,
					'fix' => null,
					'sat' => null,
					'hdop' => null,
					'vdop' => null,
					'pdop' => null,
					'ageofdgpsdata' => null,
					'dgpsid' => null,
					'difference' => null,
					'distance' => null,
					'extensions' => [
						'trackpoint' => null,
						'unsupported' => [
							'MxTimeZeroSymbol' => 10,
							'color' => -16744448,
						],
					],
				],
				[
					'lat' => 49.3636333333086,
					'lon' => 0.0800866666666667,
					'ele' => null,
					'time' => '2014-12-13T16:32:52+00:00',
					'magvar' => null,
					'geoidheight' => null,
					'name' => 'Event 0001',
					'cmt' => null,
					'desc' => null,
					'src' => null,
					'link' => [],
					'sym' => null,
					'type' => null,
					'fix' => null,
					'sat' => null,
					'hdop' => null,
					'vdop' => null,
					'pdop' => null,
					'ageofdgpsdata' => null,
					'dgpsid' => null,
					'difference' => null,
					'distance' => null,
					'extensions' => [
						'trackpoint' => null,
						'unsupported' => [
							'MxTimeZeroSymbol' => 10,
							'color' => -16744448,
						],
					],
				],
			],
			'routes' => [],
			'tracks' => [
				[
					'name' => 'Ownship',
					'cmt' => null,
					'desc' => null,
					'src' => null,
					'link' => [],
					'number' => null,
					'type' => null,
					'extensions' => [
						'trackpoint' => null,
						'unsupported' => [
							'guid' => 201,
						],
					],
					'trkseg' => [
						[
							'points' => [
								[
									'lat' => 49.3635449998312,
									'lon' => 0.0801483333364938,
									'ele' => null,
									'time' => '2010-01-01T14:48:37+00:00',
									'magvar' => null,
									'geoidheight' => null,
									'name' => null,
									'cmt' => null,
									'desc' => null,
									'src' => null,
									'link' => array(),
									'sym' => null,
									'type' => null,
									'fix' => null,
									'sat' => null,
									'hdop' => null,
									'vdop' => null,
									'pdop' => null,
									'ageofdgpsdata' => null,
									'dgpsid' => null,
									'difference' => null,
									'distance' => 0.0,
									'extensions' => null,
								],
								[
									'lat' => 49.3635350651798,
									'lon' => 0.0801416666698513,
									'ele' => null,
									'time' => '2010-01-01T14:48:40+00:00',
									'magvar' => null,
									'geoidheight' => null,
									'name' => null,
									'cmt' => null,
									'desc' => null,
									'src' => null,
									'link' => array(),
									'sym' => null,
									'type' => null,
									'fix' => null,
									'sat' => null,
									'hdop' => null,
									'vdop' => null,
									'pdop' => null,
									'ageofdgpsdata' => null,
									'dgpsid' => null,
									'difference' => 1.2055693602077022,
									'distance' => 1.2055693602077022,
									'extensions' => null,
								],
								[
									'lat' => 49.3635266991555,
									'lon' => 0.0801333333365323,
									'ele' => null,
									'time' => '2010-01-01T14:48:46+00:00',
									'magvar' => null,
									'geoidheight' => null,
									'name' => null,
									'cmt' => null,
									'desc' => null,
									'src' => null,
									'link' => array(),
									'sym' => null,
									'type' => null,
									'fix' => null,
									'sat' => null,
									'hdop' => null,
									'vdop' => null,
									'pdop' => null,
									'ageofdgpsdata' => null,
									'dgpsid' => null,
									'difference' => 1.1088552014759407,
									'distance' => 2.314424561683643,
									'extensions' => null,
								],
							],
							'extensions' => null,
							'stats' => [
								'distance' => 2.314424561683643,
								'avgSpeed' => 0.2571582846315159,
								'avgPace' => 3888.6555859279733,
								'minAltitude' => 0.0,
								'maxAltitude' => 0.0,
								'cumulativeElevationGain' => 0.0,
								'startedAt' => '2010-01-01T14:48:37+00:00',
								'finishedAt' => '2010-01-01T14:48:46+00:00',
								'duration' => 9.0,
							],
						],
					],
					'stats' => [
						'distance' => 2.314424561683643,
						'avgSpeed' => 0.2571582846315159,
						'avgPace' => 3888.6555859279733,
						'minAltitude' => 0.0,
						'maxAltitude' => 0.0,
						'cumulativeElevationGain' => 0.0,
						'startedAt' => '2010-01-01T14:48:37+00:00',
						'finishedAt' => '2010-01-01T14:48:46+00:00',
						'duration' => 9.0,
					],
				],
				[
					'name' => 'Ownship',
					'cmt' => null,
					'desc' => null,
					'src' => null,
					'link' => [],
					'number' => null,
					'type' => null,
					'extensions' => [
						'trackpoint' => null,
						'unsupported' => [
							'guid' => 102,
						],
					],
					'trkseg' => [
						[
							'points' => [
								[
									'lat' => 49.4574117319429,
									'lon' => 0.0343682156842231,
									'ele' => null,
									'time' => '2016-04-03T14:13:09+00:00',
									'magvar' => null,
									'geoidheight' => null,
									'name' => null,
									'cmt' => null,
									'desc' => null,
									'src' => null,
									'link' => array(),
									'sym' => null,
									'type' => null,
									'fix' => null,
									'sat' => null,
									'hdop' => null,
									'vdop' => null,
									'pdop' => null,
									'ageofdgpsdata' => null,
									'dgpsid' => null,
									'difference' => null,
									'distance' => 0.0,
									'extensions' => null,
								],
								[
									'lat' => 49.4573966992346,
									'lon' => 0.0343466078409025,
									'ele' => null,
									'time' => '2016-04-03T14:13:10+00:00',
									'magvar' => null,
									'geoidheight' => null,
									'name' => null,
									'cmt' => null,
									'desc' => null,
									'src' => null,
									'link' => array(),
									'sym' => null,
									'type' => null,
									'fix' => null,
									'sat' => null,
									'hdop' => null,
									'vdop' => null,
									'pdop' => null,
									'ageofdgpsdata' => null,
									'dgpsid' => null,
									'difference' => 2.2876315307770505,
									'distance' => 2.2876315307770505,
									'extensions' => null,
								],
								[
									'lat' => 49.4573700325059,
									'lon' => 0.0342948235267376,
									'ele' => null,
									'time' => '2016-04-03T14:13:12+00:00',
									'magvar' => null,
									'geoidheight' => null,
									'name' => null,
									'cmt' => null,
									'desc' => null,
									'src' => null,
									'link' => array(),
									'sym' => null,
									'type' => null,
									'fix' => null,
									'sat' => null,
									'hdop' => null,
									'vdop' => null,
									'pdop' => null,
									'ageofdgpsdata' => null,
									'dgpsid' => null,
									'difference' => 4.775098771720203,
									'distance' => 7.062730302497254,
									'extensions' => null,
								],
							],
							'extensions' => null,
							'stats' => [
								'distance' => 7.062730302497254,
								'avgSpeed' => 2.354243434165751,
								'avgPace' => 424.7649098167112,
								'minAltitude' => 0.0,
								'maxAltitude' => 0.0,
								'cumulativeElevationGain' => 0.0,
								'startedAt' => '2016-04-03T14:13:09+00:00',
								'finishedAt' => '2016-04-03T14:13:12+00:00',
								'duration' => 3.0,
							],
						],
					],
					'stats' => [
						'distance' => 7.062730302497254,
						'avgSpeed' => 2.354243434165751,
						'avgPace' => 424.7649098167112,
						'minAltitude' => 0.0,
						'maxAltitude' => 0.0,
						'cumulativeElevationGain' => 0.0,
						'startedAt' => '2016-04-03T14:13:09+00:00',
						'finishedAt' => '2016-04-03T14:13:12+00:00',
						'duration' => 3.0,
					],
				],
			],
			'extensions' => null,
		];
	}
}
