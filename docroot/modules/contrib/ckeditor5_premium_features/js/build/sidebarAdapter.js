/*!
 * Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see https://ckeditor.com/legal/ckeditor-oss-license
 */
!function(e,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.CKEditor5=i():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.sidebarAdapter=i())}(self,(()=>(()=>{"use strict";var e={d:(i,t)=>{for(var r in t)e.o(t,r)&&!e.o(i,r)&&Object.defineProperty(i,r,{enumerable:!0,get:t[r]})},o:(e,i)=>Object.prototype.hasOwnProperty.call(e,i)},i={};e.d(i,{default:()=>r});const t=class{constructor(e){this.editor=e,this.elementId=null,void 0!==this.editor.sourceElement&&(this.elementId=this.editor.sourceElement.dataset.ckeditor5PremiumElementId)}processCollaborationCommandDisable(e){if(!this.isCollaborationDisabled())return!1;const i=this.editor.commands._commands.get(e);return void 0===i||i.forceDisabled("premium-features-module"),!0}processRevisionDisable(){return!!this.isCollaborationDisabled()&&(this.editor.plugins.has("RevisionTracker")&&(this.editor.plugins.get("RevisionTracker").isEnabled=!1),!0)}isCollaborationDisabled(){return void 0!==drupalSettings.ckeditor5Premium&&void 0!==drupalSettings.ckeditor5Premium.disableCollaboration&&!0===drupalSettings.ckeditor5Premium.disableCollaboration}getEditorParentContainer(e){let i=document.getElementById(e);for(;i&&void 0!==i&&void 0!==i.classList&&!i.classList.contains("ck-editor-container");)i=i.parentElement;return i&&void 0!==i?i.parentElement:null}getSourceDataSelector(e){return{trackChanges:".track-changes",comments:".comments",revisionHistory:".revision-history",revisionHistoryContainer:".revision-history-container",resolvedSuggestionsComments:".resolved-suggestions-comments"}[e]+"-data"+`[data-ckeditor5-premium-element-id="${this.elementId}"]`}};const r={SidebarAdapter:class{constructor(e){if(this.editor=e,this.storage=new t(e),this.toolbar=this.editor.ui._toolbarConfig.items,this.sidebarMode=drupalSettings.ckeditor5SidebarMode??"auto",this.resizeThreshold=0,void 0===this.editor.sourceElement)return;let i=this.getSidebarWrapper(this.editor.sourceElement.id);void 0!==i&&i&&(this.sidebarColumn=i,this.sidebar=i.parentElement,this.editorContainer=this.sidebar.parentElement,this.editor.config._config.sidebar={container:i,preventScrollOutOfView:drupalSettings.ckeditor5Premium.preventScrollOutOfView})}static get pluginName(){return"SidebarAdapter"}sidebarVisibilityModify(e=!1){this.sidebar&&void 0!==this.sidebar&&this.sidebar.classList.toggle("slider-off",e)}init(){this.sidebar&&this.editor.plugins.has("AnnotationsUIs")&&this.addToggleButton()}afterInit(){if(!this.annotationsUIs||void 0===this.annotationsUIs||!this.sidebar||void 0===this.sidebar)return;let e=!this.toolbar.includes("trackChanges")&&!this.toolbar.includes("comment")||this.storage.isCollaborationDisabled();this.sidebarVisibilityModify(e),this.handleSidebarMode(),this.editor.config._config.sidebar.preventScrollOutOfView&&this.sidebarColumn.classList.add("prevent-scroll-out-of-view"),this.editor.on("ready",(()=>{this.setScrollBarObservers(),this.editor.ui.view.element&&(this.editor.ui.view.element.classList+=" ck-sidebar-enabled")}))}destroy(){if(!this.annotationsUIs||void 0===this.annotationsUIs||!this.sidebar||void 0===this.sidebar)return;this.resizeObserver&&this.resizeObserver.disconnect(),this.viewElementScrollbarObserver.disconnect(),this.sidebarVisibilityModify(!0);let e=this.getSidebarToggleWrapper();e&&e.remove()}addToggleButton(){this.annotationsUIs=this.editor.plugins.get("AnnotationsUIs"),this.toggleWrapper=document.createElement("div"),this.toggleWrapper.classList.add("ck-sidebar-auto-toggle-wrapper");let e=document.createElement("a");e.classList+="ck-sidebar-auto-toggle "+this.sidebarMode,e.id="ck-sidebar-auto-toggle",e.title="Switch to narrow sidebar mode",this.toggleWrapper.prepend(e),this.sidebar.prepend(this.toggleWrapper)}setScrollBarObservers(){this.viewElementScrollbarObserver=new ResizeObserver((e=>{const i=-29-(e[0].target.offsetWidth-e[0].target.clientWidth);this.toggleWrapper.style.marginLeft=i+"px"})),this.viewElementScrollbarObserver.observe(this.editor.ui.view.editable.element)}getSidebarWrapper(e){let i=this.storage.getEditorParentContainer(e);return i?i.querySelector(".ck-sidebar-wrapper"):null}handleSidebarMode(){let e=this.getSidebarToggleWrapper(),i=0;if(this.resizeObserver=new ResizeObserver((e=>{for(const t of e){const e=t.borderBoxSize?.[0].inlineSize;clearTimeout(this.resizeThreshold),this.resizeThreshold=setTimeout((()=>{"number"==typeof e&&e!==i&&(i=e,"auto"!==this.sidebarMode?this.setCkEditorSidebarMode(this.sidebarMode):this.updateCkeditorMode())}),100)}})),this.resizeObserver.observe(this.editorContainer),"auto"!==this.sidebarMode)return this.setCkEditorSidebarMode(this.sidebarMode),void(e&&(e.style.display="none"));this.updateCkeditorMode(),e&&e.addEventListener("click",(()=>{this.sidebar.classList.contains("narrowSidebar")?(this.sidebar.classList.remove("manual-toggled"),this.setCkEditorSidebarMode("wideSidebar")):(this.setCkEditorSidebarMode("narrowSidebar"),this.sidebar.classList.add("manual-toggled"))}))}getSidebarToggle(){return this.sidebar&&void 0!==this.sidebar?this.sidebar.querySelector(".ck-sidebar-auto-toggle"):null}getSidebarToggleWrapper(){return this.sidebar&&void 0!==this.sidebar?this.sidebar.querySelector(".ck-sidebar-auto-toggle-wrapper"):null}setCkEditorSidebarMode(e){if(!this.sidebar||void 0===this.sidebar)return;let i=this.getSidebarToggle();if(i.title="wideSidebar"===e?"Switch to narrow sidebar mode":"narrowSidebar"===e?"Switch to wide sidebar mode":"",this.sidebar.classList.contains("manual-toggled")&&"wideSidebar"===e){if(!this.annotationsUIs.isActive("inline")&&!this.annotationsUIs.isActive("wideSidebar"))return;e="narrowSidebar"}this.sidebar.classList.remove("inline","narrowSidebar","wideSidebar"),this.annotationsUIs.switchTo(e),this.sidebar.classList.add(e)}updateCkeditorMode(){let e=this.editorContainer.clientWidth,i=e>=720?"wideSidebar":e>=500?"narrowSidebar":"inline";this.setCkEditorSidebarMode(i)}}};return i=i.default})()));