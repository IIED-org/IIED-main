uuid: 31fe0a2a-69b2-4f40-b1af-60b688b0b0d5
langcode: en
status: true
dependencies: {  }
id: pubs_node
class: null
field_plugin_method: null
cck_plugin_method: null
migration_tags:
  - pubs
migration_group: pubs
label: 'IIED Publications nodes'
source:
  plugin: pubs_node
  constants:
    SOURCE_DOMAIN: 'https://pubscopy.iied.org/pdfs/'
    DRUPAL_FILE_DIRECTORY: 'public://pdfs/migrate/'
    PDF_SUFFIX: .pdf
process:
  uid:
    plugin: default_value
    default_value: 1
  type:
    plugin: default_value
    default_value: publication
  field_status:
    plugin: skip_on_value
    method: row
    not_equals: true
    source: Status
    value:
      - A
      - 'N'
  title: Title
  field_short_title: ShortTitle
  _product_code: ProductCode
  _lit_code: LitCode
  field_product_code: '@_product_code'
  field_lit_code: '@_lit_code'
  body/value: Abstract
  field_theme_s_:
    -
      plugin: get
      source:
        - Theme
        - Theme2
    -
      plugin: entity_lookup
      allow_multiple: true
      entity_type: taxonomy_term
      bundle: theme
      bundle_key: vid
      value_key: field_legacy_code
  field_tags:
    plugin: entity_lookup
    allow_multiple: true
    source: Keywords
    entity_type: taxonomy_term
    bundle: tags
    bundle_key: vid
    value_key: name
    ignore_case: true
  field_document_type:
    plugin: entity_lookup
    source: DocType
    entity_type: taxonomy_term
    bundle: document_type
    bundle_key: vid
    value_key: field_legacy_doctype
  field_publisher:
    -
      plugin: explode
      delimiter: ', '
      source: Publisher
    -
      plugin: entity_generate_multiple
      entity_type: taxonomy_term
      bundle: organisation
      bundle_key: vid
      value_key: name
  field_author_s_:
    plugin: entity_generate_multiple
    allow_multiple: true
    source: AuthorList
    entity_type: taxonomy_term
    bundle: person
    bundle_key: vid
    value_key: name
  _field_pdf_path:
    plugin: concat
    source:
      - constants/SOURCE_DOMAIN
      - '@_product_code'
      - constants/PDF_SUFFIX
  field_project:
    -
      source: ProjectNumber
      plugin: skip_on_value
      method: process
      value: 0
    -
      plugin: entity_lookup
      bundle_key: type
      bundle: project
      value_key: field_projectnumber
      entity_type: node
      access_check: 0
  field_pdf:
    plugin: file_import
    source: '@_field_pdf_path'
    destination: constants/DRUPAL_FILE_DIRECTORY
    skip_on_missing_source: true
    skip_on_error: true
    reuse: true
    uid: 1
  field_pdf/display:
    plugin: default_value
    default_value: 1
destination:
  plugin: 'entity:node'
migration_dependencies:
  optional:
    - pubs_themes
    - pubs_tags
    - pubs_authors
    - pubs_doctypes
    - pubs_projects
